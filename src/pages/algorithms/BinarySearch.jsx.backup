import { useState, useEffect } from 'react'
import CompletionCheckbox from '../../components/CompletionCheckbox.jsx'
import LanguageToggle from '../../components/LanguageToggle.jsx'
import DrawingCanvas from '../../components/DrawingCanvas.jsx'
import { isProblemCompleted } from '../../services/progressService'
import { getPreferredLanguage } from '../../services/languageService'
import { useKeyboardNavigation } from '../../hooks/useKeyboardNavigation'

function BinarySearch({ onBack, onPrevious, onNext, previousName, nextName, currentSubcategory, previousSubcategory, nextSubcategory, onPreviousSubcategory, onNextSubcategory }) {
  const [selectedQuestion, setSelectedQuestion] = useState(null)
  const [showSolution, setShowSolution] = useState(false)
  const [showExplanation, setShowExplanation] = useState(false)
  const [userCode, setUserCode] = useState('')
  const [output, setOutput] = useState('')
  const [isRunning, setIsRunning] = useState(false)
  const [refreshKey, setRefreshKey] = useState(0)
  const [language, setLanguage] = useState(getPreferredLanguage())
  const [showDrawing, setShowDrawing] = useState(false)
  const [currentDrawing, setCurrentDrawing] = useState(null)

  useEffect(() => {
    const handleProgressUpdate = () => setRefreshKey(prev => prev + 1)
    window.addEventListener('progressUpdate', handleProgressUpdate)
    return () => window.removeEventListener('progressUpdate', handleProgressUpdate)
  }, [])

  useEffect(() => {
    const handleLanguageChange = (e) => {
      setLanguage(e.detail)
      if (selectedQuestion) {
        setUserCode(selectedQuestion.code[e.detail].starterCode)
      }
    }
    window.addEventListener('languageChange', handleLanguageChange)
    return () => window.removeEventListener('languageChange', handleLanguageChange)
  }, [selectedQuestion])

  const questions = [
    {
      id: 1,
      title: 'Search in Rotated Sorted Array',
      difficulty: 'Medium',
      leetcodeUrl: 'https://leetcode.com/problems/search-in-rotated-sorted-array/',
      description: 'There is an integer array nums sorted in ascending order (with distinct values). Prior to being passed to your function, nums is possibly rotated at an unknown pivot index. Given the array nums after the possible rotation and an integer target, return the index of target if it is in nums, or -1 if it is not in nums.',
      explanation: `**Problem:** Search in a rotated sorted array in O(log n) time.

**Key Insight:** Even after rotation, one half of the array is always sorted. Use this to determine which half to search.

**Approach: Modified Binary Search**
1. Find mid point
2. Check if target equals mid (found!)
3. Determine which half is sorted (compare nums[left] with nums[mid])
4. Check if target is in the sorted half's range
5. Adjust search boundaries accordingly

**Complexity:** Time O(log n), Space O(1)`,
      pseudocode: `ALGORITHM SearchRotated(nums, target):
    left = 0, right = length(nums) - 1
    WHILE left <= right:
        mid = left + (right - left) / 2
        IF nums[mid] == target:
            RETURN mid

        // Determine which half is sorted
        IF nums[left] <= nums[mid]:
            // Left half is sorted
            IF target >= nums[left] AND target < nums[mid]:
                right = mid - 1  // search left
            ELSE:
                left = mid + 1   // search right
        ELSE:
            // Right half is sorted
            IF target > nums[mid] AND target <= nums[right]:
                left = mid + 1   // search right
            ELSE:
                right = mid - 1  // search left
    RETURN -1`,
      code: {
        java: {
          starterCode: `public int search(int[] nums, int target) {
    // Write your code here

}`,
          solution: `// Approach: Modified Binary Search - O(log n) time, O(1) space
public int search(int[] nums, int target) {
    int left = 0, right = nums.length - 1;

    while (left <= right) {
        int mid = left + (right - left) / 2;

        if (nums[mid] == target) {
            return mid;
        }

        // Determine which half is sorted
        if (nums[left] <= nums[mid]) {
            // Left half is sorted
            if (target >= nums[left] && target < nums[mid]) {
                right = mid - 1;
            } else {
                left = mid + 1;
            }
        } else {
            // Right half is sorted
            if (target > nums[mid] && target <= nums[right]) {
                left = mid + 1;
            } else {
                right = mid - 1;
            }
        }
    }

    return -1;
}`
        },
        python: {
          starterCode: `def search(self, nums: List[int], target: int) -> int:
    # Write your code here
    pass`,
          solution: `# Approach: Modified Binary Search - O(log n) time, O(1) space
def search(self, nums: List[int], target: int) -> int:
    left, right = 0, len(nums) - 1

    while left <= right:
        mid = left + (right - left) // 2

        if nums[mid] == target:
            return mid

        # Determine which half is sorted
        if nums[left] <= nums[mid]:
            # Left half is sorted
            if nums[left] <= target < nums[mid]:
                right = mid - 1
            else:
                left = mid + 1
        else:
            # Right half is sorted
            if nums[mid] < target <= nums[right]:
                left = mid + 1
            else:
                right = mid - 1

    return -1`
        }
      },
      testCases: [
        { nums: [4,5,6,7,0,1,2], target: 0, expected: 4 },
        { nums: [4,5,6,7,0,1,2], target: 3, expected: -1 },
        { nums: [1], target: 0, expected: -1 }
      ],
      examples: [
        { input: 'nums = [4,5,6,7,0,1,2], target = 0', output: '4' },
        { input: 'nums = [4,5,6,7,0,1,2], target = 3', output: '-1' },
        { input: 'nums = [1], target = 0', output: '-1' }
      ]
    },
    {
      id: 2,
      title: 'Find Peak Element',
      difficulty: 'Medium',
      leetcodeUrl: 'https://leetcode.com/problems/find-peak-element/',
      description: 'A peak element is an element that is strictly greater than its neighbors. Given a 0-indexed integer array nums, find a peak element, and return its index. If the array contains multiple peaks, return the index to any of the peaks. You must write an algorithm that runs in O(log n) time.',
      explanation: `**Problem:** Find any peak element in O(log n) time.

**Key Insight:** If nums[mid] > nums[mid+1], there must be a peak on the left (including mid). Otherwise, there must be a peak on the right.

**Approach: Binary Search**
1. Compare mid with mid+1
2. If mid > mid+1, peak is on left side (could be mid itself)
3. If mid < mid+1, peak is on right side (array is ascending)
4. Continue until left == right

**Complexity:** Time O(log n), Space O(1)`,
      pseudocode: `ALGORITHM FindPeak(nums):
    left = 0, right = length(nums) - 1
    WHILE left < right:
        mid = left + (right - left) / 2
        IF nums[mid] > nums[mid + 1]:
            // Peak on left (including mid)
            right = mid
        ELSE:
            // Peak on right
            left = mid + 1
    RETURN left`,
      code: {
        java: {
          starterCode: `public int findPeakElement(int[] nums) {
    // Write your code here

}`,
          solution: `// Approach: Binary Search - O(log n) time, O(1) space
public int findPeakElement(int[] nums) {
    int left = 0, right = nums.length - 1;

    while (left < right) {
        int mid = left + (right - left) / 2;

        if (nums[mid] > nums[mid + 1]) {
            // Peak is on the left side (including mid)
            right = mid;
        } else {
            // Peak is on the right side
            left = mid + 1;
        }
    }

    return left;
}

// Alternative: Iterative approach
public int findPeakElement(int[] nums) {
    for (int i = 0; i < nums.length - 1; i++) {
        if (nums[i] > nums[i + 1]) {
            return i;
        }
    }
    return nums.length - 1;
}`
        },
        python: {
          starterCode: `def findPeakElement(self, nums: List[int]) -> int:
    # Write your code here
    pass`,
          solution: `# Approach: Binary Search - O(log n) time, O(1) space
def findPeakElement(self, nums: List[int]) -> int:
    left, right = 0, len(nums) - 1

    while left < right:
        mid = left + (right - left) // 2

        if nums[mid] > nums[mid + 1]:
            # Peak is on the left side (including mid)
            right = mid
        else:
            # Peak is on the right side
            left = mid + 1

    return left

# Alternative: Iterative approach
def findPeakElement(self, nums: List[int]) -> int:
    for i in range(len(nums) - 1):
        if nums[i] > nums[i + 1]:
            return i
    return len(nums) - 1`
        }
      },
      testCases: [
        { nums: [1,2,3,1], expected: 2 },
        { nums: [1,2,1,3,5,6,4], expected: 5 }
      ],
      examples: [
        { input: 'nums = [1,2,3,1]', output: '2', explanation: '3 is a peak element and your function should return the index number 2.' },
        { input: 'nums = [1,2,1,3,5,6,4]', output: '5', explanation: 'Your function can return either index number 1 where the peak element is 2, or index number 5 where the peak element is 6.' }
      ]
    },
    {
      id: 3,
      title: 'Search a 2D Matrix II',
      difficulty: 'Medium',
      leetcodeUrl: 'https://leetcode.com/problems/search-a-2d-matrix-ii/',
      description: 'Write an efficient algorithm that searches for a value target in an m x n integer matrix. This matrix has the following properties: Integers in each row are sorted in ascending from left to right, and integers in each column are sorted in ascending from top to bottom.',
      explanation: `**Problem:** Search in a 2D matrix where rows and columns are sorted.

**Key Insight:** Start from top-right corner. From there, we can eliminate either a row or column in each step.

**Approach: Search from Top-Right Corner**
1. Start at top-right (row=0, col=n-1)
2. If target equals current, found!
3. If target < current, move left (eliminate column)
4. If target > current, move down (eliminate row)
5. Continue until found or out of bounds

**Complexity:** Time O(m+n), Space O(1)`,
      pseudocode: `ALGORITHM SearchMatrix(matrix, target):
    row = 0
    col = length(matrix[0]) - 1  // start top-right

    WHILE row < rows AND col >= 0:
        IF matrix[row][col] == target:
            RETURN true
        ELSE IF matrix[row][col] > target:
            col--  // go left
        ELSE:
            row++  // go down
    RETURN false`,
      code: {
        java: {
          starterCode: `public boolean searchMatrix(int[][] matrix, int target) {
    // Write your code here

}`,
          solution: `// Approach: Search from top-right corner - O(m+n) time, O(1) space
public boolean searchMatrix(int[][] matrix, int target) {
    if (matrix == null || matrix.length == 0) {
        return false;
    }

    int row = 0;
    int col = matrix[0].length - 1;

    while (row < matrix.length && col >= 0) {
        if (matrix[row][col] == target) {
            return true;
        } else if (matrix[row][col] > target) {
            col--;
        } else {
            row++;
        }
    }

    return false;
}

// Alternative: Binary search on each row - O(m log n) time
public boolean searchMatrix(int[][] matrix, int target) {
    for (int[] row : matrix) {
        if (binarySearch(row, target)) {
            return true;
        }
    }
    return false;
}

private boolean binarySearch(int[] arr, int target) {
    int left = 0, right = arr.length - 1;
    while (left <= right) {
        int mid = left + (right - left) / 2;
        if (arr[mid] == target) return true;
        else if (arr[mid] < target) left = mid + 1;
        else right = mid - 1;
    }
    return false;
}`
        },
        python: {
          starterCode: `def searchMatrix(self, matrix: List[List[int]], target: int) -> bool:
    # Write your code here
    pass`,
          solution: `# Approach: Search from top-right corner - O(m+n) time, O(1) space
def searchMatrix(self, matrix: List[List[int]], target: int) -> bool:
    if not matrix or not matrix[0]:
        return False

    row = 0
    col = len(matrix[0]) - 1

    while row < len(matrix) and col >= 0:
        if matrix[row][col] == target:
            return True
        elif matrix[row][col] > target:
            col -= 1
        else:
            row += 1

    return False

# Alternative: Binary search on each row - O(m log n) time
def searchMatrix(self, matrix: List[List[int]], target: int) -> bool:
    def binary_search(arr, target):
        left, right = 0, len(arr) - 1
        while left <= right:
            mid = left + (right - left) // 2
            if arr[mid] == target:
                return True
            elif arr[mid] < target:
                left = mid + 1
            else:
                right = mid - 1
        return False

    for row in matrix:
        if binary_search(row, target):
            return True
    return False`
        }
      },
      testCases: [
        { matrix: [[1,4,7,11,15],[2,5,8,12,19],[3,6,9,16,22],[10,13,14,17,24],[18,21,23,26,30]], target: 5, expected: true },
        { matrix: [[1,4,7,11,15],[2,5,8,12,19],[3,6,9,16,22],[10,13,14,17,24],[18,21,23,26,30]], target: 20, expected: false }
      ],
      examples: [
        { input: 'matrix = [[1,4,7,11,15],[2,5,8,12,19]...], target = 5', output: 'true' },
        { input: 'matrix = [[1,4,7,11,15],[2,5,8,12,19]...], target = 20', output: 'false' }
      ]
    },
    {
      id: 4,
      title: 'Find First and Last Position',
      difficulty: 'Medium',
      leetcodeUrl: 'https://leetcode.com/problems/find-first-and-last-position-of-element-in-sorted-array/',
      description: 'Given an array of integers nums sorted in non-decreasing order, find the starting and ending position of a given target value. If target is not found in the array, return [-1, -1]. You must write an algorithm with O(log n) runtime complexity.',
      explanation: `**Problem:** Find first and last occurrence of target in sorted array.

**Key Insight:** Run binary search twice - once to find first occurrence (search left when found), once for last (search right when found).

**Approach: Two Binary Searches**
1. First search: When target found, continue searching left to find first occurrence
2. Second search: When target found, continue searching right to find last occurrence
3. Both searches run in O(log n)

**Complexity:** Time O(log n), Space O(1)`,
      pseudocode: `ALGORITHM SearchRange(nums, target):
    result = [-1, -1]

    // Find first position
    left = 0, right = length(nums) - 1
    WHILE left <= right:
        mid = left + (right - left) / 2
        IF nums[mid] == target:
            result[0] = mid
            right = mid - 1  // continue left
        ELSE IF nums[mid] < target:
            left = mid + 1
        ELSE:
            right = mid - 1

    // Find last position
    left = 0, right = length(nums) - 1
    WHILE left <= right:
        mid = left + (right - left) / 2
        IF nums[mid] == target:
            result[1] = mid
            left = mid + 1   // continue right
        ELSE IF nums[mid] < target:
            left = mid + 1
        ELSE:
            right = mid - 1

    RETURN result`,
      code: {
        java: {
          starterCode: `public int[] searchRange(int[] nums, int target) {
    // Write your code here

}`,
          solution: `// Approach: Two Binary Searches - O(log n) time, O(1) space
public int[] searchRange(int[] nums, int target) {
    int[] result = new int[]{-1, -1};

    // Find first position
    int left = 0, right = nums.length - 1;
    while (left <= right) {
        int mid = left + (right - left) / 2;
        if (nums[mid] == target) {
            result[0] = mid;
            right = mid - 1; // Continue searching on left
        } else if (nums[mid] < target) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }

    // Find last position
    left = 0;
    right = nums.length - 1;
    while (left <= right) {
        int mid = left + (right - left) / 2;
        if (nums[mid] == target) {
            result[1] = mid;
            left = mid + 1; // Continue searching on right
        } else if (nums[mid] < target) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }

    return result;
}

// Alternative: Helper method approach
public int[] searchRange(int[] nums, int target) {
    int first = findBound(nums, target, true);
    if (first == -1) return new int[]{-1, -1};
    int last = findBound(nums, target, false);
    return new int[]{first, last};
}

private int findBound(int[] nums, int target, boolean isFirst) {
    int left = 0, right = nums.length - 1;
    int result = -1;

    while (left <= right) {
        int mid = left + (right - left) / 2;
        if (nums[mid] == target) {
            result = mid;
            if (isFirst) {
                right = mid - 1;
            } else {
                left = mid + 1;
            }
        } else if (nums[mid] < target) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }

    return result;
}`
        },
        python: {
          starterCode: `def searchRange(self, nums: List[int], target: int) -> List[int]:
    # Write your code here
    pass`,
          solution: `# Approach: Two Binary Searches - O(log n) time, O(1) space
def searchRange(self, nums: List[int], target: int) -> List[int]:
    result = [-1, -1]

    # Find first position
    left, right = 0, len(nums) - 1
    while left <= right:
        mid = left + (right - left) // 2
        if nums[mid] == target:
            result[0] = mid
            right = mid - 1  # Continue searching on left
        elif nums[mid] < target:
            left = mid + 1
        else:
            right = mid - 1

    # Find last position
    left, right = 0, len(nums) - 1
    while left <= right:
        mid = left + (right - left) // 2
        if nums[mid] == target:
            result[1] = mid
            left = mid + 1  # Continue searching on right
        elif nums[mid] < target:
            left = mid + 1
        else:
            right = mid - 1

    return result

# Alternative: Helper method approach
def searchRange(self, nums: List[int], target: int) -> List[int]:
    def find_bound(is_first):
        left, right = 0, len(nums) - 1
        result = -1

        while left <= right:
            mid = left + (right - left) // 2
            if nums[mid] == target:
                result = mid
                if is_first:
                    right = mid - 1
                else:
                    left = mid + 1
            elif nums[mid] < target:
                left = mid + 1
            else:
                right = mid - 1

        return result

    first = find_bound(True)
    if first == -1:
        return [-1, -1]
    last = find_bound(False)
    return [first, last]`
        }
      },
      testCases: [
        { nums: [5,7,7,8,8,10], target: 8, expected: [3,4] },
        { nums: [5,7,7,8,8,10], target: 6, expected: [-1,-1] },
        { nums: [], target: 0, expected: [-1,-1] }
      ],
      examples: [
        { input: 'nums = [5,7,7,8,8,10], target = 8', output: '[3,4]' },
        { input: 'nums = [5,7,7,8,8,10], target = 6', output: '[-1,-1]' },
        { input: 'nums = [], target = 0', output: '[-1,-1]' }
      ]
    },
    {
      id: 5,
      title: 'Minimum Absolute Difference Between Elements With Constraint',
      difficulty: 'Medium',
      leetcodeUrl: 'https://leetcode.com/problems/minimum-absolute-difference-between-elements-with-constraint/',
      description: 'You are given a 0-indexed integer array nums and an integer x. Find the minimum absolute difference between two elements in the array that are at least x indices apart. In other words, find two indices i and j such that abs(i - j) >= x and abs(nums[i] - nums[j]) is minimized. Return an integer denoting the minimum absolute difference between two elements that are at least x indices apart.',
      explanation: `**Problem:** Find minimum absolute difference between elements at least x positions apart.

**Key Insight:** Use a sorted data structure (TreeSet/SortedList) to maintain elements we've seen so far. For each position i, we can only compare with elements at indices <= i-x. Use binary search to find closest values.

**Approach: Sliding Window with Binary Search**
1. Iterate through array from index x onwards
2. Maintain a sorted set of elements from valid previous positions (at least x away)
3. For each element, use binary search to find:
   - Floor value (largest element <= current)
   - Ceiling value (smallest element >= current)
4. Track minimum absolute difference
5. Add current element to sorted set for future comparisons

**Complexity:** Time O(n log n), Space O(n)`,
      pseudocode: `ALGORITHM MinAbsoluteDifference(nums, x):
    IF length(nums) <= x:
        RETURN 0

    minDiff = INFINITY
    sortedSet = TreeSet()  // or SortedList

    // Add first x elements to set
    FOR i FROM 0 TO x-1:
        sortedSet.add(nums[i])

    // Process remaining elements
    FOR i FROM x TO length(nums)-1:
        current = nums[i]

        // Find floor (largest <= current)
        floor = sortedSet.floor(current)
        IF floor exists:
            minDiff = MIN(minDiff, current - floor)

        // Find ceiling (smallest >= current)
        ceiling = sortedSet.ceiling(current)
        IF ceiling exists:
            minDiff = MIN(minDiff, ceiling - current)

        // Add element at position i-x+1 for next iteration
        sortedSet.add(nums[i - x + 1])

    RETURN minDiff`,
      code: {
        java: {
          starterCode: `public int minAbsoluteDifference(int[] nums, int x) {
    // Write your code here

}`,
          solution: `// Approach: Sliding Window + TreeSet - O(n log n) time, O(n) space
import java.util.TreeSet;

public int minAbsoluteDifference(int[] nums, int x) {
    int n = nums.length;
    if (n <= x) return 0;

    int minDiff = Integer.MAX_VALUE;
    TreeSet<Integer> set = new TreeSet<>();

    // Add first x elements to the set
    for (int i = 0; i < x; i++) {
        set.add(nums[i]);
    }

    // Process elements starting from index x
    for (int i = x; i < n; i++) {
        int current = nums[i];

        // Find floor (largest element <= current)
        Integer floor = set.floor(current);
        if (floor != null) {
            minDiff = Math.min(minDiff, current - floor);
        }

        // Find ceiling (smallest element >= current)
        Integer ceiling = set.ceiling(current);
        if (ceiling != null) {
            minDiff = Math.min(minDiff, ceiling - current);
        }

        // Add element that becomes valid for next iteration
        set.add(nums[i - x + 1]);
    }

    return minDiff;
}

// Alternative: Using bisect approach with sorted list
public int minAbsoluteDifference(int[] nums, int x) {
    int n = nums.length;
    int minDiff = Integer.MAX_VALUE;
    TreeSet<Integer> sortedSet = new TreeSet<>();

    for (int i = 0; i < n; i++) {
        // Elements at least x positions away are valid
        if (i >= x) {
            sortedSet.add(nums[i - x]);
        }

        if (!sortedSet.isEmpty()) {
            // Find closest values using binary search
            Integer floor = sortedSet.floor(nums[i]);
            Integer ceiling = sortedSet.ceiling(nums[i]);

            if (floor != null) {
                minDiff = Math.min(minDiff, Math.abs(nums[i] - floor));
            }
            if (ceiling != null) {
                minDiff = Math.min(minDiff, Math.abs(nums[i] - ceiling));
            }
        }
    }

    return minDiff;
}`
        },
        python: {
          starterCode: `def minAbsoluteDifference(self, nums: List[int], x: int) -> int:
    # Write your code here
    pass`,
          solution: `# Approach 1: Using SortedList (from sortedcontainers)
from sortedcontainers import SortedList

def minAbsoluteDifference(self, nums: List[int], x: int) -> int:
    n = len(nums)
    if n <= x:
        return 0

    min_diff = float('inf')
    sorted_list = SortedList()

    # Add first x elements
    for i in range(x):
        sorted_list.add(nums[i])

    # Process remaining elements
    for i in range(x, n):
        current = nums[i]

        # Find position where current would be inserted
        pos = sorted_list.bisect_left(current)

        # Check floor (element before insertion point)
        if pos > 0:
            min_diff = min(min_diff, current - sorted_list[pos - 1])

        # Check ceiling (element at insertion point)
        if pos < len(sorted_list):
            min_diff = min(min_diff, sorted_list[pos] - current)

        # Add element for next iteration
        sorted_list.add(nums[i - x + 1])

    return min_diff


# Approach 2: Using bisect module (standard library)
import bisect

def minAbsoluteDifference(self, nums: List[int], x: int) -> int:
    n = len(nums)
    min_diff = float('inf')
    sorted_list = []

    for i in range(n):
        # Add elements that are at least x positions away
        if i >= x:
            bisect.insort(sorted_list, nums[i - x])

        if sorted_list:
            current = nums[i]

            # Find position using binary search
            pos = bisect.bisect_left(sorted_list, current)

            # Check floor (element before pos)
            if pos > 0:
                min_diff = min(min_diff, abs(current - sorted_list[pos - 1]))

            # Check ceiling (element at pos)
            if pos < len(sorted_list):
                min_diff = min(min_diff, abs(current - sorted_list[pos]))

    return min_diff`
        }
      },
      testCases: [
        { nums: [4,3,2,4], x: 2, expected: 0 },
        { nums: [5,3,2,10,15], x: 1, expected: 1 },
        { nums: [1,2,3,4], x: 3, expected: 3 }
      ],
      examples: [
        { input: 'nums = [4,3,2,4], x = 2', output: '0', explanation: 'Compare nums[0]=4 with nums[2]=2 and nums[3]=4. Min diff is |4-4|=0' },
        { input: 'nums = [5,3,2,10,15], x = 1', output: '1', explanation: 'Compare adjacent and further elements. Min diff is |3-2|=1' },
        { input: 'nums = [1,2,3,4], x = 3', output: '3', explanation: 'Only valid pair is (0,3): |1-4|=3' }
      ]
    }
  ]

  const handleQuestionSelect = (question) => {
    setSelectedQuestion(question)
    setUserCode(question.code[language].starterCode)
    setShowSolution(false)
    setOutput('')
    // Load existing drawing if any    const problemId = `BinarySearch-${question.id}`
    const savedDrawing = localStorage.getItem(`drawing-${problemId}`)
    setCurrentDrawing(savedDrawing)
  }

  const openDrawingModal = () => {
    if (selectedQuestion) {
      const problemId = `BinarySearch-${selectedQuestion.id}`
      const savedDrawing = localStorage.getItem(`drawing-${problemId}`)
      setCurrentDrawing(savedDrawing)
      setShowDrawing(true)
    }
  }

  const closeDrawingModal = () => {
    setShowDrawing(false)
    // Reload drawing after saving
    if (selectedQuestion) {
      const problemId = `BinarySearch-${selectedQuestion.id}`
      const savedDrawing = localStorage.getItem(`drawing-${problemId}`)
      setCurrentDrawing(savedDrawing)
    }
  }

  // Question navigation
  const currentIndex = selectedQuestion ? questions.findIndex(q => q.id === selectedQuestion.id) : -1
  const hasPrevious = currentIndex > 0
  const hasNext = currentIndex >= 0 && currentIndex < questions.length - 1

  const goToPrevious = () => {
    if (hasPrevious) {
      handleQuestionSelect(questions[currentIndex - 1])
    }
  }

  const goToNext = () => {
    if (hasNext) {
      handleQuestionSelect(questions[currentIndex + 1])
    }
  }

  const runCode = async () => {
    setIsRunning(true)
    setOutput('Running test cases...\n\n')
    await new Promise(resolve => setTimeout(resolve, 1000))

    let outputText = '=== Test Results ===\n\n'
    outputText += '‚ö†Ô∏è  Note: This is a demo environment.\n'
    outputText += 'In a production system, your code would be compiled and executed on a secure server.\n\n'

    if (selectedQuestion.testCases) {
      selectedQuestion.testCases.forEach((testCase, index) => {
        outputText += `Test Case ${index + 1}:\n`
        if (testCase.nums) {
          outputText += `Input: nums = [${testCase.nums.join(', ')}], target = ${testCase.target}\n`
        } else if (testCase.matrix) {
          outputText += `Input: matrix = [...], target = ${testCase.target}\n`
        }
        outputText += `Expected: ${JSON.stringify(testCase.expected)}\n`
        outputText += `Status: ‚è≥ Pending execution\n\n`
      })
    }

    outputText += '\nüí° Tip: Click "Show Solution" to see the optimal approach!\n'
    setOutput(outputText)
    setIsRunning(false)
  }


  return (
    <div style={{ padding: '2rem', maxWidth: '1400px', margin: '0 auto' }}>
      <div style={{ marginBottom: '2rem', display: 'flex', alignItems: 'center', gap: '1rem', justifyContent: 'space-between' }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          <button
            onClick={onBack}
            style={{
              padding: '0.75rem 1.5rem',
              fontSize: '1rem',
              fontWeight: '600',
              backgroundColor: '#3b82f6',
              color: 'white',
              border: 'none',
              borderRadius: '8px',
              cursor: 'pointer',
              transition: 'all 0.2s ease',
              boxShadow: '0 2px 8px rgba(59, 130, 246, 0.3)'
            }}
          >
            ‚Üê Back to Menu
          </button>
          <h1 style={{ margin: 0, fontSize: '2rem', fontWeight: '800', color: '#1f2937' }}>
            Binary Search Practice
          </h1>
          {currentSubcategory && (
            <span style={{
              padding: '0.5rem 1rem',
              fontSize: '0.9rem',
              fontWeight: '600',
              backgroundColor: '#dbeafe',
              color: '#1e40af',
              borderRadius: '8px',
              marginLeft: '1rem'
            }}>
              {currentSubcategory}
            </span>
          )}
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          {previousSubcategory && (
            <button
              onClick={onPreviousSubcategory}
              style={{
                padding: '0.6rem 1rem',
                fontSize: '0.85rem',
                fontWeight: '600',
                backgroundColor: '#8b5cf6',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                boxShadow: '0 2px 6px rgba(139, 92, 246, 0.3)',
                display: 'flex',
                alignItems: 'center',
                gap: '0.4rem'
              }}
              onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#7c3aed'}
              onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#8b5cf6'}
            >
              ‚¨ÜÔ∏è {previousSubcategory}
            </button>
          )}
          {nextSubcategory && (
            <button
              onClick={onNextSubcategory}
              style={{
                padding: '0.6rem 1rem',
                fontSize: '0.85rem',
                fontWeight: '600',
                backgroundColor: '#8b5cf6',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                boxShadow: '0 2px 6px rgba(139, 92, 246, 0.3)',
                display: 'flex',
                alignItems: 'center',
                gap: '0.4rem'
              }}
              onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#7c3aed'}
              onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#8b5cf6'}
            >
              {nextSubcategory} ‚¨áÔ∏è
            </button>
          )}
          {onPrevious && (
            <button
              onClick={onPrevious}
              style={{
                padding: '0.75rem 1.25rem',
                fontSize: '1rem',
                fontWeight: '600',
                backgroundColor: '#10b981',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                boxShadow: '0 2px 8px rgba(16, 185, 129, 0.3)',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
              onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#059669'}
              onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#10b981'}
            >
              ‚Üê {previousName}
            </button>
          )}
          {onNext && (
            <button
              onClick={onNext}
              style={{
                padding: '0.75rem 1.25rem',
                fontSize: '1rem',
                fontWeight: '600',
                backgroundColor: '#10b981',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                boxShadow: '0 2px 8px rgba(16, 185, 129, 0.3)',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
              onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#059669'}
              onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#10b981'}
            >
              {nextName} ‚Üí
            </button>
          )}
        </div>
      </div>

      {/* Questions List - Only show when no question is selected */}
      {!selectedQuestion && (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
          <h2 style={{ fontSize: '1.3rem', fontWeight: '700', color: '#1f2937', marginBottom: '0.5rem' }}>
            Medium Level Questions ({questions.length})
          </h2>
          {questions.map(q => {
            const isCompleted = isProblemCompleted(`BinarySearch-${q.id}`)
            return (
              <div
                key={`${q.id}-${refreshKey}`}
                style={{
                  backgroundColor: isCompleted ? '#f0fdf4' : 'white',
                  color: '#1f2937',
                  padding: '1.5rem',
                  borderRadius: '12px',
                  border: isCompleted ? '3px solid #10b981' : '2px solid #e5e7eb',
                  transition: 'all 0.2s ease',
                  boxShadow: isCompleted ? '0 2px 12px rgba(16, 185, 129, 0.2)' : '0 2px 8px rgba(0,0,0,0.1)',
                  position: 'relative'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.transform = 'translateY(-2px)'
                  e.currentTarget.style.boxShadow = isCompleted ? '0 4px 16px rgba(16, 185, 129, 0.3)' : '0 4px 12px rgba(0,0,0,0.15)'
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.transform = 'translateY(0)'
                  e.currentTarget.style.boxShadow = isCompleted ? '0 2px 12px rgba(16, 185, 129, 0.2)' : '0 2px 8px rgba(0,0,0,0.1)'
                }}
              >
                {isCompleted && (
                  <div style={{
                    position: 'absolute',
                    top: '-10px',
                    left: '-10px',
                    backgroundColor: '#10b981',
                    color: 'white',
                    borderRadius: '50%',
                    width: '32px',
                    height: '32px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '1.1rem',
                    fontWeight: 'bold',
                    boxShadow: '0 2px 8px rgba(16, 185, 129, 0.5)',
                    border: '3px solid white',
                    zIndex: 1
                  }}>
                    ‚úì
                  </div>
                )}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '0.5rem' }}>
                  <div
                    onClick={() => handleQuestionSelect(q)}
                    style={{ flex: 1, cursor: 'pointer' }}
                  >
                    <h3 style={{ margin: 0, fontSize: '1.1rem', fontWeight: '700' }}>
                      {isCompleted && <span style={{ color: '#10b981', marginRight: '0.5rem' }}>‚úì</span>}
                      {q.id}. {q.title}
                    </h3>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                    {q.leetcodeUrl && (
                      <a
                        href={q.leetcodeUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        onClick={(e) => e.stopPropagation()}
                        style={{
                          display: 'inline-flex',
                          alignItems: 'center',
                          padding: '0.25rem 0.5rem',
                          fontSize: '0.7rem',
                          fontWeight: '600',
                          color: '#3b82f6',
                          backgroundColor: '#dbeafe',
                          border: '1px solid #3b82f6',
                          borderRadius: '6px',
                          textDecoration: 'none',
                          transition: 'all 0.2s ease',
                          cursor: 'pointer',
                          gap: '0.25rem'
                        }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.backgroundColor = '#3b82f6'
                          e.currentTarget.style.color = 'white'
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.backgroundColor = '#dbeafe'
                          e.currentTarget.style.color = '#3b82f6'
                        }}
                        title="Open on LeetCode"
                      >
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                          <polyline points="15 3 21 3 21 9"></polyline>
                          <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        LC
                      </a>
                    )}
                    <span style={{
                      padding: '0.25rem 0.75rem',
                      borderRadius: '6px',
                      fontSize: '0.75rem',
                      fontWeight: '600',
                      backgroundColor: '#fbbf24',
                      color: '#78350f'
                    }}>
                      {q.difficulty}
                    </span>
                  </div>
                </div>
                <p
                  onClick={() => handleQuestionSelect(q)}
                  style={{ margin: '0.5rem 0 0 0', fontSize: '0.9rem', opacity: 0.9, lineHeight: '1.5', cursor: 'pointer' }}
                >
                  {q.description.substring(0, 100)}...
                </p>
              </div>
            )
          })}
        </div>
      )}

      {/* Question Detail - Full width when selected */}
      {selectedQuestion && (
        <div>
          <button
            onClick={() => setSelectedQuestion(null)}
            style={{
              padding: '0.75rem 1.5rem',
              fontSize: '1rem',
              fontWeight: '600',
              backgroundColor: '#6b7280',
              color: 'white',
              border: 'none',
              borderRadius: '8px',
              cursor: 'pointer',
              transition: 'all 0.2s ease',
              marginBottom: '1.5rem',
              boxShadow: '0 2px 8px rgba(107, 114, 128, 0.3)'
            }}
            onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#4b5563'}
            onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#6b7280'}
          >
            ‚Üê Back to Questions
          </button>
          <div style={{
            backgroundColor: 'white',
            padding: '2rem',
            borderRadius: '12px',
            border: '2px solid #e5e7eb',
            boxShadow: '0 4px 16px rgba(0,0,0,0.1)'
          }}>
            <div style={{ marginBottom: '1.5rem' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                  <h2 style={{ margin: 0, fontSize: '1.5rem', fontWeight: '800', color: '#1f2937' }}>
                    {selectedQuestion.id}. {selectedQuestion.title}
                  </h2>
                  {selectedQuestion.leetcodeUrl && (
                    <a
                      href={selectedQuestion.leetcodeUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        padding: '0.35rem 0.6rem',
                        backgroundColor: '#f97316',
                        color: 'white',
                        textDecoration: 'none',
                        borderRadius: '6px',
                        fontSize: '0.75rem',
                        fontWeight: '600',
                        transition: 'all 0.2s ease',
                        boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.backgroundColor = '#ea580c'
                        e.currentTarget.style.transform = 'translateY(-1px)'
                        e.currentTarget.style.boxShadow = '0 2px 6px rgba(0,0,0,0.15)'
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.backgroundColor = '#f97316'
                        e.currentTarget.style.transform = 'translateY(0)'
                        e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)'
                      }}
                      title="Open on LeetCode"
                    >
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ marginRight: '0.25rem' }}>
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                      </svg>
                      LeetCode
                    </a>
                  )}
                </div>
                <span style={{
                  padding: '0.5rem 1rem',
                  borderRadius: '8px',
                  fontSize: '0.85rem',
                  fontWeight: '700',
                  backgroundColor: '#fbbf24',
                  color: '#78350f'
                }}>
                  {selectedQuestion.difficulty}
                </span>
              </div>
              <p style={{ fontSize: '1rem', lineHeight: '1.7', color: '#4b5563', margin: '1rem 0' }}>
                {selectedQuestion.description}
              </p>

              {/* Previous/Next Navigation */}
              <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>
                <button
                  onClick={goToPrevious}
                  disabled={!hasPrevious}
                  style={{
                    padding: '0.5rem 1rem',
                    fontSize: '0.9rem',
                    fontWeight: '600',
                    backgroundColor: hasPrevious ? '#6b7280' : '#d1d5db',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: hasPrevious ? 'pointer' : 'not-allowed',
                    transition: 'all 0.2s ease',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem'
                  }}
                  onMouseEnter={(e) => {
                    if (hasPrevious) e.currentTarget.style.backgroundColor = '#4b5563'
                  }}
                  onMouseLeave={(e) => {
                    if (hasPrevious) e.currentTarget.style.backgroundColor = '#6b7280'
                  }}
                >
                  ‚Üê Previous
                </button>
                <button
                  onClick={goToNext}
                  disabled={!hasNext}
                  style={{
                    padding: '0.5rem 1rem',
                    fontSize: '0.9rem',
                    fontWeight: '600',
                    backgroundColor: hasNext ? '#6b7280' : '#d1d5db',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: hasNext ? 'pointer' : 'not-allowed',
                    transition: 'all 0.2s ease',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.5rem'
                  }}
                  onMouseEnter={(e) => {
                    if (hasNext) e.currentTarget.style.backgroundColor = '#4b5563'
                  }}
                  onMouseLeave={(e) => {
                    if (hasNext) e.currentTarget.style.backgroundColor = '#6b7280'
                  }}
                >
                  Next ‚Üí
                </button>
              </div>
            </div>

            <div style={{ marginBottom: '1.5rem' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                <h3 style={{ fontSize: '1.1rem', fontWeight: '700', color: '#1f2937', margin: 0 }}>
                  üíª Code Editor
                </h3>
                <LanguageToggle />
              </div>
              <div style={{
                backgroundColor: '#1e293b',
                borderRadius: '8px',
                overflow: 'hidden',
                border: '2px solid #334155'
              }}>
                <div style={{
                  backgroundColor: '#0f172a',
                  padding: '0.75rem 1rem',
                  borderBottom: '1px solid #334155',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <span style={{ color: '#94a3b8', fontSize: '0.85rem', fontWeight: '600' }}>
                    {language === 'java' ? 'Solution.java' : 'solution.py'}
                  </span>
                  <span style={{ color: '#64748b', fontSize: '0.75rem' }}>
                    {language === 'java' ? 'Java' : 'Python'}
                  </span>
                </div>
                <textarea
                  value={userCode}
                  onChange={(e) => setUserCode(e.target.value)}
                  onKeyDown={(e) => {
                    // Stop propagation for all keys except Escape to allow typing in textarea
                    if (e.key !== 'Escape') {
                      e.stopPropagation()
                    }

                    if (e.key === 'Tab') {
                      e.preventDefault()
                      const start = e.target.selectionStart
                      const end = e.target.selectionEnd
                      const newValue = userCode.substring(0, start) + '    ' + userCode.substring(end)
                      setUserCode(newValue)
                      setTimeout(() => {
                        e.target.selectionStart = e.target.selectionEnd = start + 4
                      }, 0)
                    }
                  }}
                  spellCheck="false"
                  style={{
                    width: '100%',
                    minHeight: '600px',
                    padding: '1rem',
                    fontFamily: '"Consolas", "Monaco", "Courier New", monospace',
                    fontSize: '0.9rem',
                    lineHeight: '1.6',
                    color: '#e2e8f0',
                    backgroundColor: '#1e293b',
                    border: 'none',
                    outline: 'none',
                    resize: 'vertical',
                    whiteSpace: 'pre',
                    overflowX: 'auto'
                  }}
                  placeholder="Write your solution here..."
                />
              </div>
              <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem', alignItems: 'center' }}>
                <button
                  onClick={runCode}
                  disabled={isRunning}
                  style={{
                    padding: '0.75rem 1.5rem',
                    fontSize: '0.95rem',
                    fontWeight: '700',
                    backgroundColor: isRunning ? '#6b7280' : '#10b981',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: isRunning ? 'not-allowed' : 'pointer',
                    transition: 'all 0.2s ease',
                    boxShadow: '0 2px 8px rgba(16, 185, 129, 0.3)',
                    flex: 1
                  }}
                >
                  {isRunning ? '‚è≥ Running...' : '‚ñ∂Ô∏è Run Code'}
                </button>
                <button
                  onClick={() => setUserCode(selectedQuestion.code[language].starterCode || '')}
                  style={{
                    padding: '0.75rem 1.5rem',
                    fontSize: '0.95rem',
                    fontWeight: '700',
                    backgroundColor: '#ef4444',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    transition: 'all 0.2s ease',
                    boxShadow: '0 2px 8px rgba(239, 68, 68, 0.3)'
                  }}
                >
                  üîÑ Reset
                </button>
              </div>
            </div>

            {output && (
              <div style={{ marginBottom: '1.5rem' }}>
                <h3 style={{ fontSize: '1.1rem', fontWeight: '700', color: '#1f2937', marginBottom: '1rem' }}>
                  üìä Output
                </h3>
                <div style={{
                  backgroundColor: '#0f172a',
                  padding: '1rem',
                  borderRadius: '8px',
                  border: '2px solid #334155'
                }}>
                  <pre style={{
                    margin: 0,
                    fontFamily: '"Consolas", "Monaco", "Courier New", monospace',
                    fontSize: '0.85rem',
                    lineHeight: '1.6',
                    color: '#e2e8f0',
                    whiteSpace: 'pre-wrap',
                    wordWrap: 'break-word'
                  }}>
                    {output}
                  </pre>
                </div>
              </div>
            )}

            <div style={{ marginBottom: '1.5rem' }}>
              <h3 style={{ fontSize: '1.1rem', fontWeight: '700', color: '#1f2937', marginBottom: '1rem' }}>
                Examples:
              </h3>
              {selectedQuestion.examples.map((example, idx) => (
                <div key={idx} style={{
                  backgroundColor: '#f9fafb',
                  padding: '1rem',
                  borderRadius: '8px',
                  marginBottom: '0.75rem',
                  border: '1px solid #e5e7eb'
                }}>
                  <div style={{ marginBottom: '0.5rem' }}>
                    <strong style={{ color: '#1f2937' }}>Input:</strong>
                    <code style={{
                      backgroundColor: '#1e293b',
                      color: '#e2e8f0',
                      padding: '0.25rem 0.5rem',
                      borderRadius: '4px',
                      marginLeft: '0.5rem',
                      fontFamily: 'monospace',
                      fontSize: '0.9rem'
                    }}>
                      {example.input}
                    </code>
                  </div>
                  <div style={{ marginBottom: example.explanation ? '0.5rem' : '0' }}>
                    <strong style={{ color: '#1f2937' }}>Output:</strong>
                    <code style={{
                      backgroundColor: '#1e293b',
                      color: '#e2e8f0',
                      padding: '0.25rem 0.5rem',
                      borderRadius: '4px',
                      marginLeft: '0.5rem',
                      fontFamily: 'monospace',
                      fontSize: '0.9rem'
                    }}>
                      {example.output}
                    </code>
                  </div>
                  {example.explanation && (
                    <div style={{ fontSize: '0.9rem', color: '#6b7280', fontStyle: 'italic' }}>
                      {example.explanation}
                    </div>
                  )}
                </div>
              ))}
            </div>

            <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', marginBottom: '1rem', flexWrap: 'wrap' }}>
              <button
                onClick={() => setShowSolution(!showSolution)}
                style={{
                  padding: '0.75rem 1.5rem',
                  fontSize: '1rem',
                  fontWeight: '700',
                  backgroundColor: showSolution ? '#10b981' : '#3b82f6',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  transition: 'all 0.2s ease',
                  boxShadow: '0 2px 8px rgba(59, 130, 246, 0.3)',
                  flex: 1,
                  minWidth: '200px'
                }}
              >
                {showSolution ? '‚úì Solution Visible' : 'üëÅÔ∏è Show Solution'}
              </button>
             <button
              onClick={openDrawingModal}
              style={{
                padding: '0.75rem 1.5rem',
                fontSize: '1rem',
                fontWeight: '700',
                backgroundColor: currentDrawing ? '#8b5cf6' : '#6366f1',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                boxShadow: currentDrawing ? '0 2px 8px rgba(139, 92, 246, 0.3)' : '0 2px 8px rgba(99, 102, 241, 0.3)'
              }}
            >
              {currentDrawing ? '‚úèÔ∏è Edit Drawing' : 'üé® Draw'}
            </button>
 <button
                onClick={() => setShowExplanation(!showExplanation)}
                style={{
                  padding: '0.75rem 1.5rem',
                  fontSize: '1rem',
                  fontWeight: '700',
                  backgroundColor: showExplanation ? '#8b5cf6' : '#f59e0b',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  transition: 'all 0.2s ease',
                  boxShadow: showExplanation ? '0 2px 8px rgba(139, 92, 246, 0.3)' : '0 2px 8px rgba(245, 158, 11, 0.3)',
                  flex: 1,
                  minWidth: '200px'
                }}
              >
                {showExplanation ? '‚úì Explanation Visible' : 'üìñ Explanation & Pseudocode'}
              </button>
              <div style={{ marginLeft: 'auto' }}>
                <CompletionCheckbox
                  problemId={`BinarySearch-${selectedQuestion.id}`}
                  label="Mark as Completed"
                  onCompletionChange={() => setRefreshKey(prev => prev + 1)}
                />
              </div>
            </div>

            {showSolution && (
              <div style={{
                backgroundColor: '#1e293b',
                padding: '1.5rem',
                borderRadius: '8px',
                overflowX: 'auto',
                marginBottom: '1rem'
              }}>
                <h3 style={{ fontSize: '1.1rem', fontWeight: '700', color: '#60a5fa', marginBottom: '1rem' }}>
                  Solution ({language === 'java' ? 'Java' : 'Python'}):
                </h3>
                <pre style={{
                  margin: 0,
                  fontFamily: '"Consolas", "Monaco", "Courier New", monospace',
                  fontSize: '0.85rem',
                  lineHeight: '1.6',
                  color: '#d4d4d4',
                  whiteSpace: 'pre',
                  overflowX: 'auto'
                }}>
                  {selectedQuestion.code[language].solution}
                </pre>
              </div>
            )}

            {showExplanation && (
              <div style={{
                backgroundColor: '#fef3c7',
                padding: '1.5rem',
                borderRadius: '8px',
                border: '2px solid #f59e0b',
                marginBottom: '1rem'
              }}>
                <h3 style={{ fontSize: '1.2rem', fontWeight: '700', color: '#92400e', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                  üìñ Explanation
                </h3>
                <div style={{
                  fontSize: '0.95rem',
                  lineHeight: '1.8',
                  color: '#78350f',
                  whiteSpace: 'pre-wrap',
                  marginBottom: '1.5rem'
                }}>
                  {selectedQuestion.explanation}
                </div>

                <div style={{
                  backgroundColor: '#1e293b',
                  padding: '1.5rem',
                  borderRadius: '8px',
                  overflowX: 'auto',
                  marginTop: '1rem'
                }}>
                  <h4 style={{ fontSize: '1.1rem', fontWeight: '700', color: '#a78bfa', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                    üîß Pseudocode
                  </h4>
                  <pre style={{
                    margin: 0,
                    fontFamily: '"Consolas", "Monaco", "Courier New", monospace',
                    fontSize: '0.9rem',
                    lineHeight: '1.6',
                    color: '#e2e8f0',
                    whiteSpace: 'pre',
                    overflowX: 'auto'
                  }}>
                    {selectedQuestion.pseudocode}
                  </pre>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Drawing Canvas Modal */}
      <DrawingCanvas
        isOpen={showDrawing}
        onClose={closeDrawingModal}
        problemId={selectedQuestion ? `BinarySearch-${selectedQuestion.id}` : ''}
        existingDrawing={currentDrawing}
      />
    </div>
  )
}

export default BinarySearch
